// SPDX-License-Identifier: MIT

pragma solidity ^0.8.9;

import {LibAccessControl} from "../libraries/LibAccessControl.sol";
import {LibMeta} from "../shared/libraries/LibMeta.sol";
import {IAccessControl} from "openzeppelin/contracts/access/IAccessControl.sol";

contract AccessControlFacet is IAccessControl {
  /**
   * dev Returns `true` if `account` has been granted `role`.
   */
  function hasRole(bytes32 role, address account)
    external
    view
    virtual
    override
    returns (bool)
  {
    return LibAccessControl.hasRole(role, account);
  }

  /**
   * dev Returns the admin role that controls `role`. See {grantRole} and
   * {revokeRole}.
   *
   * To change a role's admin, use {AccessControl-setRoleAdmin}.
   */
  function getRoleAdmin(bytes32 role)
    external
    view
    virtual
    override
    returns (bytes32)
  {
    return LibAccessControl.getRoleAdmin(role);
  }

  /**
   * dev Sets `adminRole` as ``role``'s admin role.
   *
   * Emits a {RoleAdminChanged} event.
   */
  function setRoleAdmin(bytes32 role, bytes32 adminRole) external {
    LibAccessControl.enforceRole(LibAccessControl.getRoleAdmin(role));

    LibAccessControl.setRoleAdmin(role, adminRole);
  }

  /**
   * dev Grants `role` to `account`.
   *
   * If `account` had not been already granted `role`, emits a {RoleGranted}
   * event.
   *
   * Requirements:
   *
   * - the caller must have ``role``'s admin role.
   */
  function grantRole(bytes32 role, address account) external virtual override {
    LibAccessControl.enforceRole(LibAccessControl.getRoleAdmin(role));

    LibAccessControl.grantRole(role, account);
  }

  /**
   * dev Revokes `role` from `account`.
   *
   * If `account` had been granted `role`, emits a {RoleRevoked} event.
   *
   * Requirements:
   *
   * - the caller must have ``role``'s admin role.
   */
  function revokeRole(bytes32 role, address account) external virtual override {
    LibAccessControl.enforceRole(LibAccessControl.getRoleAdmin(role));

    LibAccessControl.revokeRole(role, account);
  }

  /**
   * dev Revokes `role` from the calling account.
   *
   * Roles are often managed via {grantRole} and {revokeRole}: this function's
   * purpose is to provide a mechanism for accounts to lose their privileges
   * if they are compromised (such as when a trusted device is misplaced).
   *
   * If the calling account had been granted `role`, emits a {RoleRevoked}
   * event.
   *
   * Requirements:
   *
   * - the caller must be `account`.
   */
  function renounceRole(bytes32 role, address account)
    external
    virtual
    override
  {
    // solhint-disable-next-line reason-string
    require(
      account == LibMeta.msgSender(),
      "AccessControl: can only renounce roles for self"
    );

    LibAccessControl.revokeRole(role, account);
  }

  /**
   * dev Returns one of the accounts that have `role`. `index` must be a
   * value between 0 and {getRoleMemberCount}, non-inclusive.
   *
   * Role bearers are not sorted in any particular way, and their ordering may
   * change at any point.
   *
   * WARNING: When using {getRoleMember} and {getRoleMemberCount}, make sure
   * you perform all queries on the same block. See the following
   * https://forum.openzeppelin.com/t/iterating-over-elements-on-enumerableset-in-openzeppelin-contracts/2296[forum post]
   * for more information.
   */
  function getRoleMember(bytes32 role, uint256 index)
    external
    view
    returns (address)
  {
    return LibAccessControl.getRoleMember(role, index);
  }

  /**
   * dev Returns the number of accounts that have `role`. Can be used
   * together with {getRoleMember} to enumerate all bearers of a role.
   */
  function getRoleMemberCount(bytes32 role) external view returns (uint256) {
    return LibAccessControl.getRoleMemberCount(role);
  }
}
